DROP TABLE CALENDARIO CASCADE CONSTRAINTS;
DROP TABLE JUNTA CASCADE CONSTRAINTS;
DROP TABLE SOCIOS CASCADE CONSTRAINTS;
DROP TABLE CUOTAS CASCADE CONSTRAINTS;
DROP TABLE ACTIVIDADES CASCADE CONSTRAINTS;
DROP TABLE ACTIVIDADES_SOCIOS CASCADE CONSTRAINTS;

CREATE TABLE CALENDARIO(
    CALENDARIO_ID NUMBER PRIMARY KEY,
    ANYO DATE
);

CREATE TABLE JUNTA(
    FECHA_INI DATE UNIQUE NOT NULL,
    FECHA_FIN DATE UNIQUE NOT NULL,
    IMFORMACION VARCHAR2(128),     
    CONSTRAINT JUNTA_PK PRIMARY KEY(FECHA_INI,FECHA_FIN)
);

CREATE TABLE SOCIOS (
    COD_SOC NUMBER(9) PRIMARY KEY,
    NOMBRE VARCHAR2(24) NOT NULL,
    APELLIDOS VARCHAR2(24) NOT NULL,
    DNI VARCHAR2(9),
    FECHA_ALTA  DATE NOT NULL,
    TELEFONO NUMBER(12),
    EMAIL VARCHAR2(24),
    FECHA_NACI DATE NOT NULL,
    TIPO_SOCIO VARCHAR2(24) NOT NULL CONSTRAINT TIPO_CK CHECK (TIPO_SOCIO = 'USUARIO' OR TIPO_SOCIO = 'ADMINISTRADOR'),
    CARGO VARCHAR2(24) CONSTRAINT CARGO_CK CHECK (CARGO = 'PRESIDENTE' OR CARGO = 'VICEPRESIDENTE' OR CARGO = 'SECRETARIO' OR CARGO = 'TESORERO' OR CARGO = 'VOCAL'),
    FECHA_INICIO DATE,
    FECHA_FINAL DATE
);

CREATE TABLE CUOTAS(
    TIPO_CUOTA VARCHAR2(24) PRIMARY KEY CONSTRAINT TIPO_CUOTA_CK CHECK (TIPO_CUOTA = 'MENORES' OR TIPO_CUOTA= 'ADULTOS' OR TIPO_CUOTA= 'ADMINISTRADOR'),
    IMPORTE VARCHAR2(24) NOT NULL,
    ANYO_VALIDEZ DATE NOT NULL,
    IMPORTE_PAGO NUMBER(24) ,
    SOCIOS_COD_SOC NUMBER(9) NOT NULL CONSTRAINT SOC_COD_FK REFERENCES SOCIOS(COD_SOC)
);

CREATE TABLE ACTIVIDADES(
    COD_ACTIVI VARCHAR2(24) PRIMARY KEY,
    TIPO VARCHAR2(24) NOT NULL CONSTRAINT TIPO_ACTIVIDADES_CK CHECK (TIPO = 'SALIDA_AL_MONTE' OR TIPO = 'ALBERFGUE_FIN_DE_SEMANA' OR TIPO = 'REUNION' OR TIPO = 'COMIDA' OR TIPO = 'OTROS'),
    DIFICULTAD  VARCHAR(24) NOT NULL CONSTRAINT DIFICULTAD_CK CHECK (DIFICULTAD = 'ALTA' OR DIFICULTAD = 'MEDIA' OR DIFICULTAD = 'BAJA'),
    SOCIOS_COD_SOC NUMBER(9) NOT NULL CONSTRAINT SOC_ACTIVI_FK REFERENCES SOCIOS(COD_SOC),
    PRECIO NUMBER NOT NULL,
    MOTIVO_SUSPENSION VARCHAR2(200),
    CALENDARIO_FK NUMBER CONSTRAINT CALEND_ID_FK REFERENCES CALENDARIO(CALENDARIO_ID),
    COD_SOCIOS NUMBER(9)
);

CREATE TABLE ACTIVIDADES_SOCIOS(
    SOCIOS_COD_SOC NUMBER(9) CONSTRAINT SOCIOS_FK REFERENCES SOCIOS(COD_SOC),
    ACTIVIDADES_COD_ACTIVI VARCHAR2(8) CONSTRAINT ACTIVIDADES_FK REFERENCES ACTIVIDADES(COD_ACTIVI), 
    CONSTRAINT ACTIVIDADES_SOCIOS_PK PRIMARY KEY(SOCIOS_COD_SOC,ACTIVIDADES_COD_ACTIVI)
);

ALTER TABLE SOCIOS ADD CONSTRAINT JUNTA_SOCIS_FK FOREIGN KEY(FECHA_INICIO,FECHA_FINAL) REFERENCES JUNTA(FECHA_INI,FECHA_FIN);
ALTER TABLE ACTIVIDADES ADD CONSTRAINT ACTIVIADES_SOCIOS_FK FOREIGN KEY(COD_SOCIOS) REFERENCES SOCIOS(COD_SOC);

